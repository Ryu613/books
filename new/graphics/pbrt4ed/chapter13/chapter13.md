# 13 光的传播I: 表面反射

本章把光追理论，辐射度量学理论，蒙特卡洛采样算法结合起来，来实现两种不同的积分器，用来计算场景中物体表面散射的辐射量。这些积分器比第一章所说的RandomWalkIntegerator更有效率，用这两种积分器可以使错误数降低几百倍。

我们会以光传播等式的派生来开始，这个公式是在1.2.6章节介绍的。然后我们能正式介绍路径追踪算法，此算法应用了蒙特卡洛积分来计算这个等式。然后，我们会对SimplePathIntegrator的实现做描述，它是路径追踪的精简版实现，对于理解基本算法和调试样本算法是很有用的。然后本章会用PathIntegrator做概括总结，它是路径追踪更完整的实现。

这两个积分器会找到从相机开始的光的传输路径，并且考虑到了这些形状表面的散射效应。第14章会扩展路径追踪，使其包含介质传播的效果(本书在线版还包括了一章，用来描述双向路径追踪)

## 13.1 光传播公式

光传播公式(LTE)描述了场景中辐射量分布的平衡性，这个公式给出了在表面上某点的总反射辐射量，这个辐射量是根据表面发光，BSDF和入射光照分布到达此点的量得出的。在此我们不考虑光在介质中的传播场景，这部分会在14章介绍

让LTE的计算困难的原因是，某个点接收到的辐射量是受于场景中所有物体的几何和散射特性所影响。比如，某个很亮的光照射到一个红色物体上，可能会导致红色的光映到旁边的物体上，或者玻璃可能会在桌面上形成焦散效果。处理这种光照复杂性的渲染算法称为全局光照算法,为了与本地光照算法区分开，本地光照算法在着色计算中只使用与某一个表面属性相关的信息。

> 全局光照算法考虑场景光在所有物体相互作用的效果，本地光照算法只考虑单独的物体的着色，不会受其他物体影响

### 13.1.1 基本推导

## 13.2 路径追踪

## 13.3 一个简单的路径追踪器

## 13.4 更好的路径追踪