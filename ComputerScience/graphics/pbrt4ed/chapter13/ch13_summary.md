# 第13章重点总结

此章主要讲解了光传播方程及路径追踪的理论与实现

## 光传播方程(LTE)

用来描述表面某点的总辐射量，由于能量守恒，我们可知，某点的总出射辐射量，等于入射辐射量加上自己发出的辐射量，即可得LTE(也叫渲染方程):

$$
 L_o(p, \omega_o) = L_e(p, \omega_o) + \int_{S^2}f(p, \omega_o,\omega_i)L_i(p,\omega_i)|\cos \theta_i|d\omega_i
$$

式子中有两个量需要给出$L_e$(自身辐射量)和$L_i$(入射光辐射量)，根据能量守恒可知，某点在$\omega_i$方向上的入射光辐射量，就是此方向的某交点在$-\omega_i$方向上的出射光辐射量，若没有此交点，则入射光辐射量为0。

上式中的$L_i$,就可以用$L_e$代替。

我们把这个交点设为p',用$t(p,\omega)$代表p点转换为p'点的函数,则原LTE就可以写成:

$$
 L(p, \omega_o) = L_e(p, \omega_o) + \int_{S^2}f(p, \omega_o,\omega_i)L(t(p, \omega), -\omega_i)|\cos \theta_i|d\omega_i
$$

这个式子把L的下标去掉了，原本的$L_i$是求p点在$\omega_i$方向上的入射光辐射量，改为了p'点(即$t(p, \omega)$)在反方向上的出射辐射量。这样修改的好处，即我们只需考虑$L_e$，而后续光传播路径上的入射光辐射量，都可以通过一系列出射光辐射量替代

我们要求某点打到相机的辐射量，即求所有从光源开始，通过各种物体散射路径，最终落到相机的光辐射量的总和

可以用下式表示:

$$
L(p_1 \rightarrow p_0) = \sum_{n=1}^{\infty}P(\bar{p_n})
$$

其中$P(\bar{p_n})$给出了从路径$\bar{p_n}$经过了n+1个顶点，最终射出的辐射量,$p_n$就是光源点，$p_0$就是相机点，由于这种路径是无穷的，所以这个累加也是无穷的

利用蒙特卡洛估计法，就可以得到:

$$
L(p_1 \rightarrow p_0) \approx \sum_{n=1}^{\infty}\frac{P(\bar{p_n})}{p(\bar{p_n})}
$$

即采样一条光的路径，用这条路径的pdf加权，采样多条加权的路径后，求得平均值，就可以估计出最终打到$p_0$的光辐射量

## 两个问题的解决

### 如何计算一个无限路径的累加值

用俄罗斯轮盘赌方法，按概率中断某个$p_i$点之后的计算，已计算的部分做加权处理，最终可以得到一个无偏的估计值

### 如何对某条路径进行多次采样，以便估计出值
