# 物理式渲染技术

## 概述

本文会介绍物理式渲染技术(或称基于物理的渲染技术)的原理和实现。

读完本书应该能了解物理式渲染及实现物理式渲染，并且能够用其实现，生成较为逼真的图像

文字尽量简单易懂。期望能在提高信息质量的同时，增加信息密度，减少阅读时间，降低理解难度，最终提高阅读效率和效果

文章目前尚未完成，会在更新过程中，不断修改完善

### 阅读须知

1. 本文具有阅读门槛，读者需要先对计算机图形学，C++，高等数学，物理学有所了解，本文不会介绍相关基础知识
2. 本文预设语境是计算机图形学，所有涉及名词和定义皆只在其下成立
3. 由于本人水平有限，若有错误，请联系我指正

### 什么是渲染？

用计算机把各种三维模型的数据处理并最终生成二维图像的过程。

动画的本质就是足够快且连续地播放这些渲染后的图像，让人眼看上去在动。

### 什么是基于物理的渲染(即物理式渲染)?

为了使图片看上去更像照片拍出来的效果(更真实)，故基于物理学理论来渲染。英文缩写为pbr(Physically Based Rendering)。

pbr中最主要的思路是：参考物理学关于光的理论，模拟光在现实中的传播过程和与物体之间的作用效果。

### 基于哪些物理学理论？

严格来讲，pbr的实现其实并不完全遵循物理学理论，而是根据人眼对图像有限的分辨能力和计算机的有限的计算能力做了计算方法和方式上折衷，但是仍然可以说pbr在理念上是基于物理学的，可以说，本文所描述的pbr只是其理念的一种实现方式，这种pbr实现主要涉及的物理理论如下:

- 光学：假设光沿直线传播，并且忽略光的波动性，只考虑光的粒子性，主要关注光在真空或介质中传播现象，和光与不同物体之间的作用现象(比如散射，折射，反射等)，一般来说，主要关注光的宏观尺度现象，忽略微观尺度现象，对应光学中的几何光学的部分理论。pbr用此理论描述光的传播和交互过程。
- 辐射度量学: 由于光是电磁辐射的一种形式，pbr利用此学科用于衡量辐射能量在传播和与物体的作用的过程中，能量的变化情况。得到的各种物理量后续会被用来计算对应的颜色特征等数据
- 色度学： 任何色彩的显示，实际上都是光刺激人类的视觉神经而产生的感觉，色度学研究光对应人眼的色彩的感知关系。pbr利用此学科来描述人类观察到的颜色特征
- 光度学： 此学科描述光的各种物理特征。pbr利用此学科描述光的各种特性

以上这些知识也会涉及到数学上的几何，线性代数，微积分，和概率论统计学知识。

本文讨论的pbr实现中，对这些物理相关理论的应用不深，读者只需了解高中物理知识，同时看得懂微积分公式即可。

关于计算机的成像原理，图形的描述，显示等相关知识请参考图形学书籍

### 什么是光线追踪(ray tracing)

光线追踪，即在计算机里模拟光线传播，和光线与物体交互的过程

对这个过程做处理的(软件或硬件)模块就叫做光线追踪器(ray tracer)

pbr主要就是利用光线追踪器，来处理光相关的信息

### 如何实现pbr？

现实中拍摄照片或者人眼的观察，都是相机或人眼对观察的物体的光的信息进行了捕获和处理。要模拟真实情况，就可以根据在现实中观察或拍摄过程涉及到的事物和其联系进行概念抽象，转换为C++中的各种类。

本文用C++17面向对象的方式实现，前期代码会使用CPU计算，后期会支持GPU计算。

代码方面采用递进式迭代方法，会从简单代码开始，逐步迭代到更复杂的代码。同时，前文的描述，会被后文所扩展

由于计算机性能有限且存在误差，需要对处理和计算过程做大量精简和优化。

一般来说，渲染的图片越真实，就需要更多的计算和处理，计算机的性能消耗就越大，渲染所需时间也越长。

## pbr系统介绍

本文主要描述的是基于whitted的光线追踪算法的pbr实现，主要用于离线渲染。后期将逐步更新其他光线追踪算法和实时pbr相关内容

关键概念和对应的类的介绍如下:

### 系统的宏观处理流程

### 系统模块

## v1版实际运行效果

## 附录：理论简介

### 辐射度量学

### 色度学

### 光度学

### 蒙特卡洛积分

## 附录2：参考资料

1. [Physically Based Rendering From Theory To Implementation 4ed(更新中)](../new/graphics/pbrt4ed/pbrt4ed.md)
