# 6 几何形状

本章将对基本几何形状进行抽象。对于一个设计简洁的系统来说，良好的几何形状抽象是非常重要的。

pbrt使用了2层抽象来分离几何特征和几何形状。

1. Shape接口: 提供对基本几何属性的访问，比如表面积，包围盒，同时提供了光线相交的方法。
2. Primitive接口: 封装非几何的信息，比如材质的一些属性。

本章主要讲Shape接口，第七章会讲Primitive接口

## 6.1 Shape基本接口

### 6.1.1 包围

为了降低物体与光线相交的计算量，可以创建一个物体的三维包围体把其包围其中，包围体可以有多种实现，计算光线与物体相交前先看光线是否与包围体相交，若相交再进一步与物体计算，这样可以省去光线直接跟物体计算产生的大量不必要的光线相交计算。其中有一种是与坐标轴方向对齐的，会比较方便，每个Shape实现都必须能包围它本身，用Bounds3f来封装，返回的包围盒需要是渲染坐标系下的坐标。

包围盒同时要把表面的法线包围，NormalBounds()函数会返回法线的包围盒信息(DirectionCone),在3.8.4章节已经定义过了，这个包围盒在光线计算的时候特别有用，当一个形状发光时，这些法线包围盒可以检测这个形状在场景中某个点上没有被照射到

### 6.1.2 光线与包围盒相交

### 6.1.3 相交测试

Shape的实现类必须提供2个函数的实现，这两个函数用于测试光线与其相交。第一个是Intersect(), 会返回关于单个光线与形状第一次相交的信息，给定的光线的t应该在(0, tMax)区间。

第二个相交检测函数是Shape::IntersectP(),用于预测相交是否会发生，这个检测通常比起完整的相交测试要更高效。这个函数可以被用来检测光源是否可以看到某个点，特别是用于阴影射线上。

### 6.1.4 相交坐标空间

### 6.1.5 双面性

### 6.1.6 面积

### 6.1.7 采样

## 6.2 球体

## 6.3 圆柱体

## 6.4 圆盘

## 6.5 三角网格
