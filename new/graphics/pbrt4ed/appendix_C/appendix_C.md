# 附录C 场景描述的处理

场景描述会被转为对应的Shapes, Lights, Materials等等对象。

场景描述分为三个处理阶段:

1. 描述场景的文本文件格式会被读取，每个文件的声明会被对应ParserTarget类的实现的函数被调用
2. BasicSceneBuilder类的实例会跟踪图形的状态，比如当前材质和变换矩阵，对于场景中的每个实体(相机，光源和形状等)，生成一个物体
3. BasicScene实例会汇总被BasicSceneBuilder生成的物体，然后创建对应的物体类型，用于渲染

一旦BasicScene完成处理，会被传到RenderCPU()或RenderWaveFront()函数中，这些函数之后会创建最终用于渲染的场景。对于大部分类型的场景物体，这两个函数都会调用BasicScene的某个函数，来返回场景描述中对应的物体。这两个函数不同的地方是在它们如何对可相交场景几何的呈现方式。在RenderCPU()中，也包括正在CPU中执行的wavefront渲染器，在第七章定义的图元和加速器都被用于表示场景中的几何体，而在GPU渲染中，这些形状会被转换为GPU的光线追踪API需要的表示形式。

## C.1 标记和解析