# 第五章总结

pbrt中相机的实现参考了真实世界中对应相机的照相原理和效果

pbrt中的相机的抽象模型，包括相机本身的类型(正交投影，透视投影), 镜头(Lens)，快门(Shutter)，胶片(Film)，感光器(PixelSensor)，滤光片(Filter)

相机类会持有镜头，快门，胶片；胶片类会持有感光器和滤光片

代码的类结构是Camera接口下有CameraBase基类,继承此基类的是ProjectiveCamera(基于投影的相机),又下属2个子类OrthographicCamera(正交投影相机)和PerspectiveCamera(透视投影相机)

## 相机坐标空间

### 为什么要那么多坐标系

由于渲染把各种工作抽象成不同模块，方便复用和分工合作，不同模块在工作时由于还不知道渲染用哪个坐标系，就先图方便，自己定义坐标系，但是最终渲染还是需要联合起来放在一个场景中，就需要在多个坐标系之间做转换，最终统一到一个坐标系下

### 哪几种坐标系

pbrt中主要是下列几种坐标系定义：

1. 物体空间: 图元自己的坐标系，比如:一个球体图元，为了方便，球心就可定在物体空间的坐标原点
2. 世界空间: 整个场景的坐标系，当物体放到场景中时，要从物体空间转成世界空间坐标
3. 相机空间: 相机放置于场景某点，原点是相机所在点，观察方向是z轴方向，相机顶部方向是y轴方向，坐标轴和原点随着相机移动而移动
4. 相机-世界空间: 原点是相机场景中的点，但是坐标轴与世界空间坐标方向一致，相机移动不会改变坐标轴方向，只会改变原点坐标
5. 渲染空间: 渲染时所基于的坐标空间，可以是世界空间，相机空间，或者相机-世界空间

这部分坐标系的转换方法统一放在CameraTransform中

## 相机的类型

分为正交投影相机和透视投影相机，正交投影效果没有近大远小效果，透视投影类似人眼，有近大远小效果

## 相机的可视范围

相机可以看到的视野是有限的，一方面是模拟现实情况，一方面也减轻计算机计算压力。

这里以透视投影为例:

在场景中，定义两个矩形面，分别代表场景中最近可看到的面和最远可看到的面，从相机所在点出发，按照相机-近平面左上角点-远平面左上角点，相机-近平面右上角点-远平面右上角点...以此类推形成了一个四棱锥，这个四棱锥的近平面和远平面截出来的中间部分，就是可视区域，在区域外的部分会在渲染时被裁切丢弃。

这个四棱锥也叫视锥体(Frustrum)

![图5.2](img/fg5_2.png)

如上图，近平面和远平面所基于的坐标系也分为3种:

1. 屏幕空间: 相机基于相机空间，把能看到的物体的坐标投影到胶片面后的坐标，注意z值是有意义的，在[0,1]之间，近平面上z=0,远平面上z=1，近平面就是胶片面
2. NDC空间: 被渲染的图像真正的坐标系，z值与屏幕空间中的值一样，但是x,y要变换到[0,1]之间,(0,0)是左上角，(1,1)是右下角
3. 光栅空间: x,y值是图像分辨率的像素数，其他跟NDC空间一致。

注意：屏幕空间中，(0,0)在左下角, NDC和光栅空间，(0,0)在左上角，也就是y方向是反的

### 相机镜头

### 胶片
