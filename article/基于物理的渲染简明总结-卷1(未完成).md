# 物理式渲染技术-从新手到专家

## 1 概述

本文会以实践型学习方法：从新手到学徒，而不是从理论到实践的方法来介绍物理式渲染技术，相关理论会在实践中穿插，且深度会分阶段进行深入和更新

文章大概会以 新手 -> 学徒 -> 老手 -> 专家来区分理论和实践水平

本文预期读者(若有😂)为具有计算机程序开发能力，且对计算机图形渲染感兴趣的人。

本文到中后期是有难度的，请做好心理准备。希望轻松体验的读者可以先考虑以RayTracingInOneWeekend系列来入门

读完本文的读者，应该能了解物理式渲染的基础理论，并且实现物理式渲染，最终生成较为逼真的图像

文字尽量简单易懂。期望能在提高信息质量的同时，增加信息密度，减少阅读时间，降低理解难度，最终提高阅读效率和效果

本文预期是长期工程，目前尚未完成，但会尽量保证内容让读者有所收获，我会在更新过程中，不断修改完善

### 1.1 阅读须知

1. 阅读本文前，读者需要了解计算机图形学，C++，数学(微积分，线性代数)，若了解概率论统计学和物理学更佳
2. 由于物理式渲染涉及的知识横跨多个学科，为避免歧义，本文所有名词和相关解释，皆以计算机图形学为语境。
3. 写作不易，由于本人水平有限，若有错误，请直接联系我

### 1.2 什么是渲染？

用计算机程序把二维或三维模型的数据进行处理，并最终生成二维图像的过程。

动画的本质就是足够快且连续地播放这些渲染后的图像，让人眼看上去在动。

### 1.3 什么是基于物理的渲染?

基于物理的渲染(英文缩写为pbr(Physically Based Rendering))，主要目的是利用物理学理论，使渲染出来的图片跟照片一样真实。

而真实感的来源，最主要的一部分就是模拟现实中光的传播和与物体作用的过程。

### 1.4 基于哪些物理学理论？

严格来讲，pbr的实现其实并不完全遵循物理学理论，而是根据人眼对图像有限的分辨能力和计算机的有限的计算能力，在计算方法和方式上做了很多折衷，但是仍然可以说pbr在理念上是基于物理学的

本文所描述的pbr只是其理念的一种实现方式，这种pbr实现主要涉及的物理理论如下:

- **光学**：对应几何光学的部分理论，pbr用此理论描述光的传播和交互过程。
  - 在pbr中，假设光沿直线传播，并且忽略光的波动性，只考虑光的粒子性，主要关注光在真空或介质中传播现象，和光与不同物体之间的作用现象(比如散射，折射，反射等)。同时，一般来说，主要关注光的宏观尺度现象，忽略微观尺度现象
- **辐射度量学**: 由于光是电磁辐射的一种形式，pbr利用此学科用于衡量辐射能量在传播和与物体的作用的过程中，能量的变化情况。得到的各种物理量后续会被用来计算对应的颜色特征等数据
- **色度学**： 任何色彩的显示，实际上都是光刺激人类的视觉神经而产生的感觉，色度学研究光对应人眼的色彩的感知关系。pbr利用此学科来把辐射能转换为人类观察到的颜色特征
- **光度学**： 此学科描述光的各种物理特征。pbr利用此学科描述光的各种物理量

以上这些知识也会涉及到数学上的几何，线性代数，微积分，和概率论统计学知识。

本文讨论的pbr实现中，对这些物理相关理论的应用不深，读者只需了解高中物理知识，同时看得懂微积分方程，知道向量，矩阵的含义和基本计算规则即可。

关于计算机的成像原理，图形的描述，显示等相关知识请参考图形学书籍

### 1.5 什么是光线追踪(ray tracing)

**光线追踪**：用物理方法模拟光线传播和与一个或多个物体作用过程的一种算法。在光线追踪的过程中会计算出光的多个相关的物理量。

对应的(软件或硬件)模块就叫做光线追踪器(ray tracer)

pbr目前几乎都是利用光线追踪器实现的。也就是说，光线追踪是pbr的一种主要的，目前也是默认的技术实现方法。

### 1.6 如何实现光线追踪？

现实中拍摄照片或者人眼的观察，都是相机或人眼对观察的物体的光的信息进行了捕获和处理。要模拟真实情况，就可以根据在现实中观察或拍摄过程涉及到的事物和其联系进行概念抽象，利用面向对象的编程方法，转换为各种类，然后在这些类中做调用和计算，最终实现光线追踪。

由于计算机性能有限且存在误差，需要对处理和计算过程做大量精简和优化。

一般来说，渲染的图片越真实，就需要更多的计算和处理，计算机的性能消耗就越大，渲染所需时间也越长。

### 1.7 现实中的观察过程

> todo: 对现实中关键事物抽象及其联系进行介绍, 建模画图

## 2 实现

## 2.1 入门级

> 光追最简建模：点光源，物体(漫反射球体) 相机(透视)
>
> 场景： 一个球，根据光源光照方向，带特定颜色的渐变

## 2.2 新手级

> 入门级追加：物体(材质(漫反射，电导体)，立方体)，相机(镜头)
>
> 场景： 简单光线追踪，针孔相机，单色球体，明暗和遮挡表现

## 2.3 学徒级

> 简单路径追踪: 点光源，进阶相机模型(镜片，胶片)，物体几种简单材质，RGB色彩空间

## 2.4 老手级

> 进阶路径追踪: LTE, 光谱建模，采样器，面光源，物体纹理，BSDF，进阶相机模型(滤波器),多线程，场景加载，运行效率优化，调试，日志功能
>
> 路径追踪及其优化，vulkan路径追踪, 实时光追, GPU，多线程，优化，Falcur/Filament/UE代码解读

## 2.5 专家级

> 介质，体渲染，GPU编程，MLT，神经网络渲染，开源项目解读，新技术解读

## 2.6 大师

> 量子计算渲染，AI渲染，非线性空间，进阶物理建模，高级数学理论在图形学中的应用，新图形学思路

1. [Physically Based Rendering From Theory To Implementation 4ed](https://www.pbr-book.org/4ed/contents)
2. [erobert: ray-tracing](https://cs.stanford.edu/people/eroberts/courses/soco/projects/1997-98/ray-tracing/index.html)
3. [papalqi：光线追踪介绍](https://zhuanlan.zhihu.com/p/72673165)
4. [Wentao.Wang: pbr rendering](https://segmentfault.com/a/1190000000526976)
